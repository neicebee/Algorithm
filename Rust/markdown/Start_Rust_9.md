# 🦀 Rust Day 9

## **🏳️ Understanding Ownership**
- 소유권은 러스트의 독특한 기능 중 하나
- 가비지 콜렉터(Garbage Collector)에 의존하지 않고도 메모리 안정성을 보장하려는 러스트만의 해법
  - `Garbage Collection` (통칭 GC)
    - 메모리 관리 방법 중 하나로, 프로그래머가 동적으로 할당한 메모리 영역 중 더 이상 쓰이지 않는 영역을 자동으로 찾아내어 해제하는 기능
    - **_시스템에서 가비지 컬렉션을 수행하는 부분을 컬렉터라 칭함_**
    - 보통 쓰레기 수집 기능을 채택한 언어의 경우 프로그래머에게 직접적인 메모리 할당과 해제를 하게 하는 대신에 쓰레기 수집기에서 제공하는 할당과 해제를 사용하게 하여 프로그램이 실행되는 중간중간에 쓸모가 없어진 메모리, 즉 쓰레기를 알아서 수집함

### **1️⃣ 소유권이란?**
- **소유권은 러스트의 핵심 기능. 언어 전체에 깊이 관여하고 있는 개념**
- 프로그램들의 메모리 관리 방법
  - 가비지 콜렉터를 이용해 메모리를 관리하는 언어
  - 프로그래머가 명시적으로 메모리를 할당하고 해제해 주어야 하는 언어
- 러스트는 제 3의 방법 사용
  - 메모리는 컴파일러가 컴파일 시점에 검사하는 다양한 규칙으로 이루어진 `소유권 시스템` 에 의해 관리됨
  - 때문에 소유권과 관련된 기능은 프로그램의 실행 성능에 아무런 영향을 미치지 않음
  - _러스트와 소유권 시스템의 규칙에 익숙해질수록 더 안전하며 효율적인 코드 작성 가능_
- **스택(Stack) 메모리와 힙(Heap) 메모리**
  - 러스트 같은 시스템 프로그래밍 언어 환경에서는 값이 스택 메모리에 저장되었는지 힙 메모리에 저장되었는지에 따라 언어의 동작이나 의사결정에 큰 영향을 미침
  - 스택과 힙은 코드가 런타임에 활용하는 메모리의 일부이며 각자 다른 방법으로 데이터를 구성함
  - **스택(Stack)**
    - 유입된 순서대로 데이터 저장
    - 읽을 때는 유입된 반대 순서
      - 즉, 마지막에 들어온 값을 가장 먼저 읽는 구조(LIFO, Last In, First Out)
    - 쌓인 데이터 중간에 다른 데이터를 삽입하거나 꺼내는 동작은 허용되지 않음
    - 스택에 새로운 데이터를 쌓는 동작 => `push`
    - 스택의 제일 위에서 데이터를 꺼내는 동작 => `pop`
    - 스택에 저장하는 모든 데이터는 고정된 크기를 가져야 함
  - **힙(Heap)**
    - 컴파일 시점에 크기를 알 수 없는 데이터나 런타임에 동적으로 크기가 변하는 데이터는 힙에 저장
    - 스택에 비해 복잡함
    - 힙에 데이터를 넣는 동작은 메모리의 일정 공간을 할애할 것을 요청하는 것 => OS는 힙 메모리에서 일정 공간을 찾아 사용중인 메모리로 표시한 후, 해당 메모리의 주솟값인 포인터(pointer)를 넘겨줌
    - 위의 과정을 `힙 메모리 할당(allocating on the heap)` 또는 단순히 `할당(allocating)` 이라고 칭함
    - **_스택에 값을 푸시하는 동작에는 할당이 발생하지 않음_**
      - 포인터는 이미 크기가 고정된 값이므로 포인터는 스택에 저장할 수 있지만, 실제 포인터가 가리키는 데이터가 필요할 때는 포인터가 가리키는 메모리를 따라가야 함
  - 스택에 데이터를 푸시하는 것이 힙에 할당하는 것보다 빠름
    - OS가 새 데이터를 저장할 공간을 찾을 필요가 없기 때문
    - 새 데이터는 항상 스택의 가장 위에 추가됨
    - 힙에 공간을 할당하는 것은 상대적으로 더 많은 작업 필요
    - OS가 먼저 데이터를 저장할 충분히 큰 공간을 찾은 후 다음 할당 작업을 위한 예약 작업을 수행해야 하는 이유
  - 힙에 저장된 데이터에 대한 접근은 스택에 저장된 데이터에 접근하는 것보다 느림
    - 포인터를 따라가야 하기 때문
    - 현대의 프로세서들은 메모리 사이를 왔다 갔다 하는 일이 더 적을수록 더 빠르게 동작
    - 멀리 떨어진 데이터(Heap)를 처리할 때보다는 다른 데이터에 가까운 데이터(Stack)를 처리할 때 더 능률적으로 동작
    - 큰 공간을 힙 메모리에 할당하려면 어느 정도 시간이 필요
  - 코드에서 함수 호출 시 이 함수에는 여러 값들이 전달되며, 이 값들은 함수의 로컬 변수에 할당되어 스택에 저장됨
    - 함수의 실행 완료 시 이 값들은 스택에서 제거됨
  - 코드의 어느 부분이 힙 메모리에 저장된 데이터를 사용하는지 추적하고 힙에 저장되는 데이터의 중복을 최소화해 사용하지 않는 데이터를 힙 메모리에서 제거하면 메모리 부족 문제를 해소할 수 있음
    - 러스트의 소유권 기능이 이 문제를 해결하려는 방법
    - 소유권은 힙 데이터를 관리하려고 존재하는 것

#### **🤔 소유권 규칙**
- 러스트가 다루는 각각의 값은 소유자(owner)라고 부르는 변수를 가지고 있음
- 특정 시점에 값의 소유자는 단 하나뿐임
- 소유자가 범위를 벗어나면 그 값은 제거됨
- 